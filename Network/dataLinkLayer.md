# 数据链路层 #

> <font color="#000000">**目的**：</font>设计数据链路层的主要目的就是在原始的、有差错的物理线路的基础上，采取差错检测、差错控制与流量控制等方法，将有差错的物理线路改进成逻辑上无差错的数据链路，以便向它的上一层——网络层提供高质量的服务。
> <font color="#000000">**要点**：</font>：数据链路层的链路管理、数据帧封装、差错控制、流量控制这几项功能的实现原理，BSC、SDLC、HDLC和PPP这几种典型的数据链路层协议及二交换原理。

## 数据链路层基础 ##

数据链路层和它下面的网络层其实作用一样，都是用来构建进行网络通信、访问的通道，只不过物理层构建的是一条物理通道，而数据链路层构建的是真正用于数据传输的逻辑通道。

### 主要功能和实现原理 ###
向网络层提供透明、可靠的数据传输服务。<br>数据链路管理、封装成帧、透明传输、差错控制。

* 数据链路层提供的服务类型
  * 有确认的面向链接服务
  在提供服务时，必须先建立好双方通信链接，在提供服务时，必须要求对方确认后才进行。
  存在三个阶段：数据链路建立，数据传输，数据链路释放等阶段。
  占用一条专门的通信链路，是非常可靠的链接服务。
  例如：SLIP（串行线路协议）、PPP（点对点协议）、PPPoE（基于以太网的点对点协议）、HDLC（高级数据链路控制协议）

  * 有确认的无连接服务
  接收端接收到每一个数据帧时都向发送端确认，进行数据传输前不需要建立专门的数据链路的。（实际上是因为数据链路已近建立起来，永久存在）
  虽然不用建立专门的链接，但是可以保证数据可靠传输。
  例如：令牌环网，令牌总线网，各种无线通信系统。

  * 无确认的无连接服务
  接收端结束到数据帧不需要进行确认，也不需要建立链接。
  看似不可靠，但是是建立在可靠通信线路基础上，数据传输仍十分可靠。
  例如：以太网。

### 数据封装成帧和透明传输 ###

* 网络层传输的包（packet,又称分组），在数据链路层中传输的是“帧”（frame）。数据包到达数据链路层后加上数据链路层的协议头和协议尾就构成了一个完整的帧。

* 由数据包封装的数据帧其大小是受对应的数据链路层协议的MTU（最大传输单元）限制的。例如以太网数据链路层封装网络层IP包的MTU值为1500字节（数据部分不超过1500）还有最小限制，例如以太网封装的IP包最小值为46字节，如果小于，则用特殊字符填充。

### 比特流的帧组装及透明传输原理 ###

在发送端数据链路层中的帧到达物理层后就会以比特位为单位进行传输，而不是以帧。 接收端物理层把比特流向数据链路层传输，到达后又要将比特流封装成数据帧，这就是帧同步问题。

* 字节计数法
  以一个特殊字符代表一个帧的起始，并以一个专门的字段标识当前帧长度。

* 字符填充收尾界定法
  用特定的字符界定一个帧的起始与结束。为了防止与相同字符被误判成帧头和帧尾，可以在帧头填充一个转义控制字符。

* 比特填充的收尾界定法
  在收尾插入特定的比特串（例如：01111110），为了防止误判，传输的数据如果连续出现五个“1”则在后面插入一个“0”。
  例如：0110111111011111001 变为：01111110 011011111010111110001 01111110
  很容易由硬件实现，性能优于字符填充方式。

* 违法编码法
  只适用于采用冗余编码的特殊编码环境。
  例如：曼切斯特编码中利用“高-高”电平和“低-低”电平来界定帧的起始与终止。

## 差错控制 ##

* 差错检测
  一般通过对差错编码进行校验，常见的校验方法有奇偶校验码（Parity Check Code，PCC）、循环冗余校验（Cyclic Redundancy Check，CRC）两种。

  * 奇偶校验法：在传输的二进制最后专门设置一个奇偶校验位，来记录代码中的“1”的个数是基数还是偶数。
  * 循环冗余校验：是在数据后加上一段通过该数据生成的固定位数的校验法。

* 差错纠正
  针对不同的传输类型采取了不同的纠错方法。
  对于面向字符的，一般采用“反馈检测”的方法来进行纠错。接收端收到后向发送端发送一个相同的帧，发送端判断是否正确，如果正确则不发消息，如果错误，则发送DEL字符，提示接收端删除对应的帧。
  但是这种传输方法效率低。所以，一般采用“自动重发请求”（ARQ法）。先发送带冗余检测码的数据，接收端对数据帧进行错误检测，如果错误，则返回请求重发的响应（不用返回全部帧）。